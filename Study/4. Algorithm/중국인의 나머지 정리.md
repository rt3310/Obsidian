## 모듈로 합동

먼저 중국인의 나머지 정리를 살펴보기 전에 모듈로 합동에 대해 알고 가야 한다.

두 정수 $a$, $b$와 정수 $n (n > 1)$이 주어질 때 $n$이 $a$, $b$의 차의 약수인 경우(즉, $a - b = kn$을 만족하는 정수 $k$가 있는 경우) 모듈로 합동이라고 한다.

이는 $a ≡ b  \space(mod \space n)$, 즉 $a \space mod \space n = b \space mod \space n$ 라는 뜻이다. (≡ 는 동치의 의미이다)

## 중국인의 나머지 정리(CRT; Chinese Remainder Theorem)

중국인의 나머지 정리는 **연립 합동식의 유일한 해**를 찾는 정리이다.

예를 들어, 다음 연립 합동식이 2개 있다고 해보자.
${\begin{cases}x≡3 \space(mod \space5) ⇢ (a)\\ x≡4 \space(mod \space7) ⇢ (b)\\\end{cases}}$

위 두 합동식 (a), (b)를 모두 만족하는 정수 $x$는 어떻게 찾을 수 있을까?

어떤 수 $x$는 위 두 합동식을 모두 만족하기 위해 $(a)$, $(b)$의 해를 각각 $A_1$, $A_2$라고 하면 아래의 형태가 된다.

$x≡A_1 + A_2 \space(mod \space5 \cdot 7)$

식 (a)를 만족하기 위해 $A_1$은 5로는 나누어 떨어지지 않아야 한다(나머지가 남아야 하니까). 즉, `mod 5 * 7 = 35`에서 5를 제외한 나머지 수들의 곱을 포함한 수이다. 마찬가지로 $A_2$는 7로 나누어 떨어지지 않는 수이므로 식은 아래와 같이 적을 수 있다.

$x≡7a_1 + 5a_2 \space(mod \space5 \cdot 7)$

위 식을 이용해서 다시 전개해보면 두 합동식을 모두 만족함을 알 수 있다.

${\begin{cases}x≡7a_1 + 5a_2 \space(mod \space 5) ≡ 7a_1 + 0 \space(mod \space 5) ≡ A_1\\ x≡7a_1 + 5a_2 \space(mod \space 7) ≡ 0 + 5a_2 \space (mod \space 7) ≡ A_2\\\end{cases}}$

그럼 이제 문제는 $7a_1 ≡ 3$, $5a_2 ≡ 4$를 만족시키는 $a_1$, $a_2$를 찾아야 한다.

모듈러 연산만 아니라면 수를 이항시켜서 바로 구할 수 있는데, 모듈러 연산에서는 그리 쉽지 않다.
모듈러 연산에서 곱셈의 역원을 찾기 위해 [확장 유클리드 알고리즘](https://ko.wikipedia.org/wiki/%EC%9C%A0%ED%81%B4%EB%A6%AC%EB%93%9C_%ED%98%B8%EC%A0%9C%EB%B2%95#.ED.98.B8.EC.A0.9C.EB.B2.95.EC.9D.98_.ED.99.95.EC.9E.A5)이 필요하다. (작은 수는 직접 찾을 수 있다)

> [!info] 모듈러 연산에서의 곱셈의 역원
> 곱셈의 역원은 [페르마의 소정리](https://ko.wikipedia.org/wiki/%ED%8E%98%EB%A5%B4%EB%A7%88%EC%9D%98_%EC%86%8C%EC%A0%95%EB%A6%AC)나 [확장 유클리드 알고리즘](https://ko.wikipedia.org/wiki/%EC%9C%A0%ED%81%B4%EB%A6%AC%EB%93%9C_%ED%98%B8%EC%A0%9C%EB%B2%95#.ED.98.B8.EC.A0.9C.EB.B2.95.EC.9D.98_.ED.99.95.EC.9E.A5)으로 구할 수 있다.
> a에 곱해져서 1로 만드는 수를 곱셈의 역원 $a^{-1}$로 표기한다. 작은 수로 간단한 예시를 들면, 아래의 식을 만족하면 된다.
> 
> $if \space a≡2 \space(mod \space 3), a \cdot a^{-1} ≡ 1 \space (mod \space 3)$
> 
> $mod \space 3$에서 가능한 $a^{-1}$은 많지만, 그 중 하나인 $2^3 = 8$로 정해본다면,
> 
> $a \cdot a^{-1} ≡ 2 \cdot 8 = 16 ≡ 1 \space (mod \space 3)$
> 
> 을 만족하는 것을 알 수 있다.

이제 각 합동식을 만족하는 $a_1$, $a_2$는 역원을 이용해서 아래처럼 전개하면 구할 수 있다.

${\begin{cases} 7a_1 ≡7 \space(7^{-1} \cdot 3) ≡ 3 \space(mod \space 5) \\ 5a_2≡ 5 \space(5^{-1} \cdot 4) ≡ 4 \space (mod \space 7)\\\end{cases}}$

${\begin{cases} 7a_1 =7 \space(7^{-1} (mod \space 5) \cdot 3) = 7 \cdot(3 \cdot 3) = 63 \\ 5a_2= 5 \space(5^{-1} (mod \space 7) \cdot 4) = 5 \cdot (10 \cdot 4) = 200\\\end{cases}}$

$x = A_1 + A_2 = 7a_1 + 5a_2 = 63 + 200 = 263 ≡ 18 \space(mod \space 35)$
### 역원 구하는 과정
$7^{-1} \space(mod \space 5)$는 5가 소수이고 5와 7이 서로소이므로, 페르마의 소정리에 의해 구할 수 있다.
페르마의 소정리를 이용하면 $7^{-1} ≡ 7^{5-2} ≡ 7^3 = 343 ≡ 3 \space (mod \space 5)$

#### 페르마의 소정리
소수 $p$와 정수 $a$에 대해서 $a^p ≡ a \space (mod \space p)$,
만약 $a$와 $p$가 서로소이면 $a^{p-1} ≡ 1 \space (mod \space p)$를 만족한다.

즉, 위의 식은 $a=7$, $p=5$ 에서,
$7^{5} ≡ 7 \space (mod \space p)$ → $7^{5-1} ≡ 1 \space (mod \space p)$ → $7^{5-2} ≡ 7^{-1} \space (mod \space p)$ → $7^{-1} ≡ 7^{5-2} \space (mod \space p)$
의 과정으로 볼 수 있다.

원하던 $x$를 구했다. 두 합동식에 $x = 18$을 대입해보면 신기하게도 모두 만족한다.