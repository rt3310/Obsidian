## 트랜잭션(Transaction)

트랜잭션이라는 것은 데이터베이스 내에서 **하나의 논리적 기능을 수행하기 위해 행해지는 작업의 단위** 또는 **한 번에 사용되는 하나 이상의 쿼리를 모아 놓은 쪼갤 수 없는 작업의 논리적인 단위**이다.

- 각 트랜잭션은 하나의 특정 작업으로 시작을 해서 묶여 있는 모든 작업들을 다 완료해야 정상적으로 종료한다.
- 만약 하나의 트랜잭션에 속해있는 여러 작업 중에서 단 하나의 작업이라도 실패하면, 이 트랜잭션에 속한 모든 작업을 실패한 것으로 판단한다.
- 작업이 하나라도 실패하게 되면 트랜잭션도 실패이고, 모든 작업이 성공적이면 트랜잭션 또한 성공이다.
- 성공 또는 실패라는 두 개의 결과만 존재하는 트랜잭션은, 미완료된 작업없이 모든 작업을 성공해야 한다.

## ACID

ACID는 데이터베이스 내에서 일어나는 하나의 트랜잭션의 안정성을 보장하기 위해 필요한 성질이다.

### Atomicity (원자성)
트랜잭션은 **분해가 불가능한 최소의 단위인 하나의 원자처럼 동작**한다는 의미.

원자성이란 시스템에서 **한 트랜잭션의 연산들이 모두 성공**하거나, 반대로 **전부 실패되는 성질**을 말한다.

원자성은 작업이 모두 반영되거나 모두 반영되지 않음으로서 결과를 예측할 수 있어야 한다.
- 하나의 단위로 묶여있는 여러 작업이 부분적으로 실행된다면, 업데이트가 일어났지만 누가 업데이트했는지 모르거나, 업데이트 날짜가 누락되는 등 데이터가 오염될 수 있다.

예를 들어 계좌이체를 할 때는 다음과 같은 두 단계가 있다.
1. A 계좌에서 출금한다.
2. B 계좌에 입금한다.

계좌이체를 하려는데 A 계좌에서는 출금이 이뤄지고, B 계좌에 입금되지 않았다고 가정해보자.

어디서 문제가 발생했는지 파악할 수 없다면, A 계좌에서 출금된 돈은 세상에서 사라지는 돈이 된다. 만약 은행에서 이런 일이 발생한다면, 은행은 더 이상 제 기능을 할 수 없을 것이다.

A 계좌에서 출금하는 일에 성공했지만, B 계좌에 입금하는 작업에 실패한다면 계좌 A에서 출금하는 작업을 포함하여 모든 작업이 실패로 돌아가야 한다는 것이 원자성(Atomicity)이다.

원자성을 지켰다면 1, 2번 두 작업 모두 성공적으로 완료되어야 한다. 그렇지 않으면, 하나의 단위로 묶여있는 모든 작업이 실패하게 만들어 기존 데이터를 보호한다(롤백시킨다).

### 일관성(Consistency)
트랜잭션 작업이 시작되기 전에 데이터베이스 상태가 일관된 상태였다면 **트랜잭션 작업이 종료된 후에도 일관성 있는 데이터베이스 상태를 유지**해야 한다.

일관성은 데이터베이스 상태가 일관되어야 한다는 성질이다.

일관성은 하나의 트랜잭션 이전과 이후, 데이터베이스의 상태는 이전과 같이 유효해야 한다. 다시 말해, **트랜잭션이 일어난 이후의 데이터베이스는 데이터베이스의 제약이나 규칙을 만족해야 한다**는 뜻이다.

예를 들어, ‘모든 고객은 반드시 이름을 가지고 있어야 한다’는 데이터베이스의 제약이 있다고 가정한다.

다음과 같은 트랜잭션은 일관성을 위반한다.
1. 이름 없는 새로운 고객을 추가하는 쿼리
2. 기존 고객의 이름을 삭제하는 쿼리

데이터베이스의 유효한 상태는 다를 수 있지만, 데이터 상태에 대한 일관성은 변하지 않아야 한다.

위 예시는 ‘이름이 있어야 한다’라는 제약을 위반한다. 따라서 예시 트랜잭션이 일어난 이후의 데이터베이스는 일관되지 않는 상태를 가지게 된다.

### 고립성(Isolation)
트랜잭션 작업 수행 중에는 **다른 트랜잭션에 영향을 주어서도 안되고, 다른 트랜잭션들에 의해 간섭을 받아서도 안 된다**는 것을 의미한다.

고립성은 모든 트랜잭션은 **다른 트랜잭션으로부터 독립**되어야 한다는 뜻이다.

실제로 동시에 여러 개의 트랜잭션들이 수행될 때, 각 트랜잭션은 고립되어 있어 **연속으로 실행된 것과 동일한 결과**를 나타낸다.

예를 들어, 계좌에 만 원이 있다고 가정하자. 이 계좌로부터 계좌 B로 6천 원을, 계좌 C로 6천 원을 동시에 계좌이체하는 경우, 계좌 B에 먼저 송금한 뒤 계좌 C에 보내는 결과와 동일해야 한다. 동시에 트랜잭션을 실행한다고 해서 계좌 B와 C에 각각 6천 원씩 송금하여 마이너스 통장이 되는 것이 아니다. 각각의 송금 작업을 연속으로 실행하는 것과 동일한 결과가 나타나야 한다.

격리성을 지키는 각 트랜잭션은 철저히 독립적이기 때문에, 다른 트랜잭션의 작업 내용을 알 수 없다. 그리고 트랜잭션이 **동시에 실행될 때와 연속으로 실행될 때의 데이터베이스 상태가 동일해야 한다**.

### 지속성(Durability)
일련의 데이터 조작(트랜잭션 조작)을 완료하고 완료 통지를 사용자가 받는 시점에서 **그 조작이 영구적이 되어 그 결과를 잃지 않는 것**을 나타낸다.

지속성은 하나의 **트랜잭션이 성공적으로 수행되었다면, 해당 트랜잭션에 대한 로그가 남아야하는 성질**을 말한다.
만약 **런타임 오류나 시스템 오류가 발생하더라도, 해당 기록은 영구적이어야 한다**는 뜻이다.

예를 들어, 은행에서 계좌이체를 성공적으로 실행한 뒤에, 해당 은행 데이터베이스에 오류가 발생해 종료되더라도 계좌이체 내역은 기록으로 남아야 한다.

마찬가지로 계좌이체를 로그로 기록하기 전에 시스템 오류 등에 의해 종료가 된다면, 해당 이체 내역은 실패로 돌아가고 각 계좌들은 계좌이체 이전 상태로 돌아가게 된다.