## 미리 컴파일 된 헤더

미리 컴파일 된 헤더는 자주 변경되지 않는 긴 소스를 미리 컴파일하여 컴파일 결과를 별도의 파일에 저장한다. 이렇게 하여 다시 똑같은 헤더를 컴파일 시 해당 파일을 처음부터 컴파일하지 않고 미리 컴파일 된 헤더 파일을 사용해 컴파일 속도를 월등히 향상 시켜준다.

미리 컴파일 할 헤더를 만들 때는 신중하게 생각하여 만드는게 중요하다.
미리 컴파일 된 헤더를 만들고 난 뒤, 추후에 수정할 일이 생기게 되어 수정하게 되면 미리 컴파일 된 헤더를 다시 만들어야 되는 일이 생긴다.
때문에 헤더를 추가할 때는 교체할 일이 자주 없고 크기가 큰(컴파일 시간이 긴) 헤더를 추가 시키는 것이 좋다.

## In Visual Studio

Visual Studio에서 새 프로젝트를 만들면 미리 컴파일 된 헤더 파일(`pch.h`)이 프로젝트에 추가된다. (Visual Studio 2017 및 이전 버전에서는 `stdafx.h` 파일이 호출되었다)
파일의 목적은 빌드 프로세스의 속도를 높이기 위한 것이다. 모든 안정적인 헤더 파일(e.g. `<vector>`와 같은 표준 라이브러리 헤더)은 여기에 포함되어야 한다.
**미리 컴파일된 헤더는 이 헤더나 이 헤더가 포함하는 모든 파일이 수정될 때만 컴파일 된다**. 즉, 프로젝트 소스 코드를 변경하는 경우에만 빌드가 미리 컴파일 된 헤더에 대한 컴파일을 건너뛴다.

### 소스 코드를 미리 컴파일해야 하는 경우
미리 컴파일 된 코드는 개발 주기 동안 컴파일 시간을 단축하는 데 유용하다. 특히 다음과 같은 경우에 유용하다.
- 자주 변경되지 않는 코드의 본문 중 대부분을 항상 사용하는 경우
- 프로그램은 여러 모듈로 구성되며, 이 모든 모듈은 포함 파일 표준 집합 및 동일한 컴파일 옵션을 사용한다. 이 경우 모든 포함 파일을 미리 컴파일 된 하나의 헤더로 미리 컴파일 할 수 있다.
첫 번째 컴파일(미리 컴파일 된 헤더 파일을 만드는 컴파일)은 후속 컴파일보다 약간 더 오래 걸린다. 후속 컴파일은 미리 컴파일 된 코드를 포함함으로써 더 빠르게 진행될 수 있다.

> [!note] 참고
> 소스 파일 당 미리 컴파일 된 헤더 파일(`.pch`) 하나만 사용할 수 있지만 프로젝트에서 여러 `.pch` 파일을 사용할 수 있다.

## 미리 컴파일 된 헤더 일관성 규칙

PCH 파일에는 컴퓨터 환경에 대한 정보 및 프로그램에 대한 메모리 주소 정보가 포함되어 있으므로 PCH 파일을 만든 컴퓨터에서만 사용해야 한다.

## 미리 컴파일 된 헤더의 파일 별 사용에 대한 일관성 규칙

`\Yu` 컴파일러 옵션을 사용하면 사용할 PCH 파일을 지정할 수 있다.

PCH 파일을 사용하는 경우 컴파일러는 달리 지정하지 않는 한 PCH 파일을 만들 때 적용된 것과 동일한 컴파일 환경을 가정한다. 컴파일 환경에는 컴파일러 옵션, pragma 등이 포함된다.
불일치가 검색되면 컴파일러는 경고를 표시하고 가능한 경우 불일치를 식별한다. 반드시 이러한 경고가 PCH 파일에 문제가 있음을 나타내는 것은 아니며 단지 있을 수 있는 충돌을 경고할 뿐이다.


https://woo-dev.tistory.com/m/349